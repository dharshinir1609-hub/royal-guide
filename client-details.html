<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Details – TourMate</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="details-page">
    <aside class="sidebar glass-card">
        <a href="index.html" class="sidebar-logo text-white text-decoration-none fw-bold">TourMate</a>
        <nav class="sidebar-nav">
            <a href="dashboard.html">Dashboard</a>
            <a href="client-details.html" class="active">Client Details</a>
            <a href="future-plans.html">Future Plans</a>
            <a href="hotel-selection.html">Hotel Selection</a>
            <a href="map.html">Map</a>
        </nav>
        <a href="#" class="btn btn-logout mt-auto" onclick="handleLogout(event)">Logout</a>
    </aside>

    <main class="details-main">
        <header class="dashboard-header glass-header d-flex align-items-center justify-content-between flex-wrap gap-2">
            <h1 class="h4 mb-0 text-white">Client Details</h1>
            <a href="dashboard.html" class="btn btn-secondary btn-sm">← Back to Dashboard</a>
        </header>

        <div class="details-content container-fluid py-4">
            <div class="glass-card form-card mb-4 p-4">
                <h3 class="h5 text-white mb-4">Add New Client</h3>
                <form id="clientForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="clientName" class="form-label">Client Name *</label>
                            <input type="text" class="form-control glass-input" id="clientName" placeholder="Enter client name" required>
                            <span class="error-msg" id="clientNameError"></span>
                        </div>
                        <div class="col-md-6">
                            <label for="days" class="form-label">Number of Days *</label>
                            <input type="number" class="form-control glass-input" id="days" min="1" max="90" placeholder="e.g. 5" required>
                            <span class="error-msg" id="daysError"></span>
                        </div>
                        <div class="col-md-6">
                            <label for="budget" class="form-label">Budget (₹) *</label>
                            <input type="number" class="form-control glass-input" id="budget" min="1000" placeholder="e.g. 25000" required>
                            <span class="error-msg" id="budgetError"></span>
                        </div>
                        <div class="col-md-6">
                            <label for="preferredHotel" class="form-label">Preferred Hotel *</label>
                            <select class="form-select glass-input" id="preferredHotel" required>
                                <option value="">Select hotel</option>
                            </select>
                            <span class="error-msg" id="hotelError"></span>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary mt-3">Save Client</button>
                </form>
            </div>

            <div class="glass-card clients-table-card p-4">
                <h3 class="h5 text-white mb-3">Enrolled Clients</h3>
                <div class="table-responsive">
                    <table class="table table-dark table-hover align-middle clients-table">
                        <thead>
                            <tr>
                                <th>Client Name</th>
                                <th>Days</th>
                                <th>Budget</th>
                                <th>Preferred Hotel</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody"></tbody>
                    </table>
                </div>
                <p id="noClientsMsg" class="no-data-msg text-white-50 text-center py-4 mb-0">No clients saved yet. Add a client above.</p>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script>
        (function() {
            if (!requireAuth()) return;

            const hotelSelect = document.getElementById('preferredHotel');
            getHotelOptions().forEach(h => {
                const opt = document.createElement('option');
                opt.value = h.id;
                opt.textContent = h.name;
                hotelSelect.appendChild(opt);
            });

            function renderClientsTable() {
                const tbody = document.getElementById('clientsTableBody');
                const noMsg = document.getElementById('noClientsMsg');
                const clients = getClients();
                if (clients.length === 0) {
                    tbody.innerHTML = '';
                    noMsg.style.display = 'block';
                    return;
                }
                noMsg.style.display = 'none';
                tbody.innerHTML = clients.map(c => {
                    const hotel = getHotelOptions().find(h => h.id === c.preferredHotelId) || { name: c.preferredHotel || '—' };
                    return `<tr>
                        <td>${c.clientName}</td>
                        <td>${c.days}</td>
                        <td>₹${Number(c.budget).toLocaleString()}</td>
                        <td>${hotel.name}</td>
                        <td><button class="btn btn-sm btn-danger" onclick="deleteClient(${c.id}); if(window.renderClientsTable) window.renderClientsTable();">Delete</button></td>
                    </tr>`;
                }).join('');
            }
            window.renderClientsTable = renderClientsTable;

            document.getElementById('clientForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const clientName = document.getElementById('clientName').value.trim();
                const days = parseInt(document.getElementById('days').value, 10) || 0;
                const budget = parseInt(document.getElementById('budget').value, 10) || 0;
                const preferredHotelId = document.getElementById('preferredHotel').value;

                document.querySelectorAll('.error-msg').forEach(el => el.textContent = '');
                let valid = true;
                if (clientName.length < 2) { document.getElementById('clientNameError').textContent = 'At least 2 characters'; valid = false; }
                if (days < 1 || days > 90) { document.getElementById('daysError').textContent = 'Between 1 and 90'; valid = false; }
                if (budget < 1000) { document.getElementById('budgetError').textContent = 'Min ₹1,000'; valid = false; }
                if (!preferredHotelId) { document.getElementById('hotelError').textContent = 'Select a hotel'; valid = false; }

                if (!valid) return;

                const hotel = getHotelOptions().find(h => h.id === preferredHotelId);
                saveClient({
                    id: Date.now(),
                    clientName,
                    days,
                    budget,
                    preferredHotelId,
                    preferredHotel: hotel ? hotel.name : ''
                });
                this.reset();
                renderClientsTable();
            });

            document.addEventListener('DOMContentLoaded', renderClientsTable);
        })();
    </script>
</body>
</html>
